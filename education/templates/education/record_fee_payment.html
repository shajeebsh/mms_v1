{% extends "wagtailadmin/base.html" %}
{% load i18n wagtailadmin_tags %}

{% block titletag %}Record Fee Payment{% endblock %}

{% block content %}
{% include "wagtailadmin/shared/header.html" with title="Record Fee Payment" icon="money" %}

<div class="nice-padding">
    {% if messages %}
        {% for message in messages %}
            <div class="messages">
                <ul class="messagelist">
                    <li class="{% if message.tags %}{{ message.tags }}{% endif %}">{{ message }}</li>
                </ul>
            </div>
        {% endfor %}
    {% endif %}

    <form method="post" class="fee-payment-form">
        {% csrf_token %}

        {% if enrollment %}
            <input type="hidden" name="enrollment_id" value="{{ enrollment.id }}">
            <div class="help-block help-info">
                <p><strong>Student:</strong> {{ enrollment.student.full_name }}</p>
                <p><strong>Class:</strong> {{ enrollment.class_instance.name }}</p>
                <p><strong>Course Fee:</strong> ₹{{ enrollment.class_instance.course_fee }}</p>
                <p><strong>Already Paid:</strong> ₹{{ enrollment.total_paid }}</p>
                <p><strong>Balance Due:</strong> <span style="color: #d9534f; font-weight: bold;">₹{{ enrollment.balance_amount }}</span></p>
            </div>
        {% else %}
            <div class="field">
                <label for="enrollment_id">Select Student Enrollment:</label>
                <select name="enrollment_id" id="enrollment_id" required>
                    <option value="">-- Select Student --</option>
                    {% for e in enrollments %}
                        <option value="{{ e.id }}">{{ e.student.full_name }} - {{ e.class_instance.name }} (Balance: ₹{{ e.balance_amount }})</option>
                    {% endfor %}
                </select>
            </div>
        {% endif %}

        <div class="field">
            <label for="amount">Payment Amount (₹):</label>
            <input type="number" name="amount" id="amount" step="0.01" min="0.01" 
                   {% if enrollment %}max="{{ enrollment.balance_amount }}" value="{{ enrollment.balance_amount }}"{% endif %} required>
        </div>

        <div class="field">
            <label for="payment_date">Payment Date:</label>
            <input type="date" name="payment_date" id="payment_date" value="{{ today|date:'Y-m-d' }}" required>
        </div>

        <div class="field">
            <label for="payment_method">Payment Method:</label>
            <select name="payment_method" id="payment_method" required>
                {% for method_code, method_name in payment_methods %}
                    <option value="{{ method_code }}">{{ method_name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="field">
            <label for="reference_number">Reference Number / Receipt No:</label>
            <input type="text" name="reference_number" id="reference_number" placeholder="Optional - Transaction ID or Receipt No">
        </div>

        <div class="field">
            <label for="remarks">Remarks:</label>
            <textarea name="remarks" id="remarks" rows="3" placeholder="Optional notes"></textarea>
        </div>

        <div class="actions">
            <button type="submit" class="button button-primary">Record Payment</button>
            <a href="{% url 'education_pending_fees' %}" class="button button-secondary">Cancel</a>
        </div>
    </form>
</div>

<style>
.fee-payment-form {
    max-width: 600px;
}

.field {
    margin-bottom: 20px;
}

.field label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.field input, .field select, .field textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.actions {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #ddd;
}

.button {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    margin-right: 10px;
}

.button-primary {
    background-color: #007cba;
    color: white;
}

.button-secondary {
    background-color: #f7f7f7;
    color: #333;
    border: 1px solid #ccc;
}

.help-block {
    background-color: #f0f4f8;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.help-block p {
    margin: 5px 0;
}
</style>
{% endblock %}
