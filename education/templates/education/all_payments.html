{% extends "wagtailadmin/base.html" %}
{% load i18n wagtailadmin_tags %}

{% block titletag %}All Fee Payments{% endblock %}

{% block content %}
{% include "wagtailadmin/shared/header.html" with title="All Fee Payments" icon="money" %}

<div class="nice-padding">
    <div class="row">
        <div class="col-12">
            <div class="help-block help-info">
                <p>Total Collected: <strong>₹{{ total_collected }}</strong></p>
            </div>
        </div>
    </div>

    <form method="get" class="filter-form" style="margin-bottom: 20px;">
        <div style="display: flex; gap: 15px; align-items: end;">
            <div class="field">
                <label for="class_id">Filter by Class:</label>
                <select name="class_id" id="class_id">
                    <option value="">All Classes</option>
                    {% for cls in classes %}
                        <option value="{{ cls.id }}" {% if selected_class == cls.id|stringformat:"s" %}selected{% endif %}>{{ cls.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="field">
                <label for="status">Filter by Status:</label>
                <select name="status" id="status">
                    <option value="">All Statuses</option>
                    <option value="pending" {% if selected_status == 'pending' %}selected{% endif %}>Pending</option>
                    <option value="partial" {% if selected_status == 'partial' %}selected{% endif %}>Partial</option>
                    <option value="paid" {% if selected_status == 'paid' %}selected{% endif %}>Paid</option>
                    <option value="exempt" {% if selected_status == 'exempt' %}selected{% endif %}>Exempt</option>
                </select>
            </div>
            <button type="submit" class="button">Apply Filter</button>
            <a href="{% url 'education_all_payments' %}" class="button button-secondary">Clear</a>
        </div>
    </form>

    <div class="actions" style="margin-bottom: 20px;">
        <a href="{% url 'education_record_fee_payment' %}" class="button button-primary">Record New Payment</a>
    </div>

    <table class="listing">
        <thead>
            <tr>
                <th>Date</th>
                <th>Student</th>
                <th>Class</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Reference</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in payments %}
            <tr>
                <td>{{ payment.date }}</td>
                <td class="title">
                    <div class="title-wrapper">
                        <a href="{% url 'education_payment_history' enrollment_id=payment.enrollment.id %}">{{ payment.enrollment.student.full_name }}</a>
                    </div>
                </td>
                <td>{{ payment.enrollment.class_instance.name }}</td>
                <td>₹{{ payment.amount }}</td>
                <td>{{ payment.get_payment_method_display }}</td>
                <td>{{ payment.reference_number|default:"-" }}</td>
                <td>
                    <a href="{% url 'education_payment_history' enrollment_id=payment.enrollment.id %}" class="button button-small button-secondary">View History</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">No payments found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
.filter-form .field {
    margin-bottom: 0;
}

.filter-form .field label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

.filter-form .field select {
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    min-width: 200px;
}

.button {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
}

.button-primary {
    background-color: #007cba;
    color: white;
}

.button-secondary {
    background-color: #f7f7f7;
    color: #333;
    border: 1px solid #ccc;
}

.button-small {
    padding: 4px 10px;
    font-size: 12px;
}

.help-block {
    background-color: #f0f4f8;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}
</style>
{% endblock %}
